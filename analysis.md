# Технический анализ и выбор решения

## Цель

Определить всех людей на видео `crowd.mp4`, выделить рамками и сохранить результат. При этом:
- исключить не-людей (например, автобус),
- учесть движения в кадре и плотную толпу,
- добиться максимального качества при ограниченных условиях.

## Почему выбрана модель YOLOv8 и как она работает

Для решения задачи детекции людей на видео я выбрал модель из семейства YOLO (You Only Look Once), а именно — YOLOv8. Это однопроходный детектор объектов, разработанный для работы в реальном времени и хорошо подходящий для видеоаналитики.

YOLOv8 обладает рядом преимуществ:

- работает быстро и стабильно «из коробки»;
- имеет предобученные веса на датасете COCO, где класс `person` детектируется с высокой точностью;
- доступна через библиотеку `ultralytics`, легко интегрируется с Python;
- поддерживает разные по размеру и точности модели (`n`, `m`, `l`, `x`), что позволяет выбрать оптимальный баланс для задачи.

YOLOv8 работает следующим образом:

1. **Модель получает изображение целиком**, без нарезки на регионы (в отличие от R-CNN-подобных подходов).
2. **Сеть предсказывает координаты рамок, уровень уверенности (confidence)** и вероятности классов в один проход.
3. После предсказания применяется **порог уверенности**, чтобы отсеять слабые рамки.
4. Далее используется **NMS (Non-Maximum Suppression)** — механизм, который удаляет перекрывающиеся рамки, оставляя только наиболее вероятные (на основе метрики IoU — Intersection over Union).

YOLOv8 использует улучшенные подходы, включая `anchor-free` детекцию, `CIoU loss`, и адаптивные assigner-методы, что позволяет ей надёжно работать в условиях плотной сцены, движения камеры и плохого качества видео.

Выбор YOLOv8 обусловлен требованием задания использовать готовую модель, высокой скоростью работы и способностью достаточно точно находить людей даже в сложных условиях без необходимости в дополнительной настройке.

## Испытанные решения

### Модели YOLOv8:
- `yolov8n.pt` (nano)
- `yolov8m.pt` (medium)
- `yolov8l.pt` (large)
- `yolov8x.pt` (x-large)

### Параметры:
- Порог уверенности: 0.25, 0.3, 0.5, 0.0
- Апскейл изображения: 1.0, 1.5, 2.0
- Пробовались разные комбинации моделей + апскейл + порог

## Дополнительные подходы

- Motion map: реализована функция сравнения между кадрами (разность по пикселям), визуализировалась в углу кадра. Позволяла исключать статичные объекты.  
  ❌ Отклонено — так как при движении камеры результат становился нестабильным, добавлялись ложные движения по фону и автобусу.

- Фильтрация по размеру рамки: тестировалась, чтобы убрать автобус  
  ❌ Отклонено — так как терялись реальные рамки.

## Выбор финальной модели

После сравнений было решено использовать:

- Модель: `YOLOv8l`
- Порог: 0.0
- Апскейл: не использовался (1.0)

### Почему YOLOv8l?

- При прочих равных даёт наиболее стабильные результаты в условиях:
  - низкого качества видео,
  - плотной толпы,
  - движения камеры.
- Модель обнаруживала больше реальных людей и дольше удерживала их в кадре, чем nano и x-версии.

## Выводы по результатам работы программы

Программа успешно обрабатывает видео, выделяет людей и сохраняет результат. Были протестированы разные модели, параметры и фильтрации. Использование YOLOv8l без ограничения по порогу дало наилучший результат по полноте обнаружения при приемлемом числе ложных срабатываний.

## Шаги по дальнейшему улучшению

- Использовать трекеры (например, Deep SORT), чтобы удерживать идентификаторы людей между кадрами
- Дообучить YOLOv8l на вручную размеченных фреймах из данного видео. Это позволит повысить точность детекции конкретно для этой сцены, особенно в условиях плотной толпы и низкого качества. Однако такой подход снижает универсальность модели и может ухудшить её способность обобщать на другие видео
- Повысить качество входного видео путём апскейла или предварительной обработки
